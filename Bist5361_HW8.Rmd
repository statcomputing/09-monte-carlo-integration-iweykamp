---
title: "BIST5361_HW8"
author: "Ian Weykamp"
date: "10/29/2020"
output: html_document
---

(5.3.3)
1.

$dr(t)=\alpha b dt+\sigma dW_t$
$dr(t)=\alpha b dt - \alpha r(t) dt + \sigma dW_t$
$dr(t) + \alpha r(t) dt = \alpha b e^{\alpha t} dt +\sigma e^{\alpha t} dW_t$
$e^{\alpha t}d r(t) + \alpha e^{\alpha t} r(t) dt = \alpha b e^{\alpha t} dt + \sigma e^{\alpha t} dW_t$
$\int_0^{\Delta}d(e^{\alpha t}r(t))=\int_0^{\Delta} \alpha b e^{\alpha t} dt + \int_0^{\Delta} \sigma e{\alpha t}dW_t$
$e^{\alpha \Delta}r(\Delta)-e^{0}r(t) = \alpha b \frac{e^{\alpha \Delta}-e^0}{\alpha} + \sigma \int_0^{\Delta}e^{\alpha t}dW_t$
$r(\Delta) - r(t)e^{-\alpha \Delta}=b(1-e^{-\alpha \Delta})+\sigma e^{-\alpha \Delta} \int_0^{\Delta}e^{\alpha t}dW_t$
$r(\Delta) = r(t) e^{-\alpha \Delta}+b(1-e^{-\alpha \Delta})+\sigma e^{-\alpha \Delta} \int_0^{\Delta}e^{\alpha (\Delta-t)}dW_t$
$$r(\Delta) = r(t) e^{-\alpha \Delta}+b(1-e^{-\alpha \Delta})+\frac{\sigma}{\sqrt{2\alpha}}\sqrt{1-e^{(-2\alpha \Delta)}}Z$$

2.
````{r}
OU <- function(T=500, n, sigma, alpha, b, r0, delta=1/500){
collect <- rep(0,n)

  for(i in seq(1:n)){
    rt <- r0 * exp(-alpha * delta) + b * (1 - exp(-alpha * delta)) + 
      sigma / sqrt(2 * alpha) * sqrt(1 - exp(-2 * alpha * delta)) * 
      dnorm(n,0,1)
    collect[i] <- rt
    r0 <- rt
  }
  z = seq(1:n)
  plot(z, collect, xlab= "r_t", ylab="iter", main=c(sigma,alpha,b))
}
  
n=100
OU(500, n, 0.1, 0.1, -5, 1/500)
OU(500, n, 0.1, 1, -5, 1/500)
OU(500, n, 0.1, 5, -5, 1/500)
OU(500, n, 0.1, 0.1, 5, 1/500)
OU(500, n, 0.1, 1, 5, 1/500)
OU(500, n, 0.1, 5, 5, 1/500)

OU(500, n, 0.2, 0.1, -5, 1/500)
OU(500, n, 0.2, 1, -5, 1/500)
OU(500, n, 0.2, 5, -5, 1/500)
OU(500, n, 0.2, 0.1, 5, 1/500)
OU(500, n, 0.2, 1, 5, 1/500)
OU(500, n, 0.2, 5, 5, 1/500)

OU(500, n, 0.5, 0.1, -5, 1/500)
OU(500, n, 0.5, 1, -5, 1/500)
OU(500, n, 0.5, 5, -5, 1/500)
OU(500, n, 0.5, 0.1, 5, 1/500)
OU(500, n, 0.5, 1, 5, 1/500)
OU(500, n, 0.5, 5, 5, 1/500)

````

Alpha seems to control the speed of convergence while b is a scaling factor for the final outcome.


3.
````{r}
set.seed(123)
Euler <- function(T,n,alpha,b,sigma,r0,delta){
  dw  <- rnorm(n, 0, sqrt(T/n))
  dt  <- T/n
  r <- c(r0)
  for (i in 2:(n+1)) {
    r[i]  <-  r[i-1] + alpha*(b-r[i-1])*dt*delta + sigma*dw[i-1]
  }
  return(r);
}

delta = 1
n = 1000
sigma = 0.5

out1 <- Euler(T=500, n=1000, alpha=1, b=5, sigma = 0.2, r0=1/500, delta)
nrv <- rnorm(n, out1[n], (sigma*delta)^2)
plot(density(nrv))
lines(density(out1), col = "red")

delta = 0.5
out2 <- Euler(T=500, n=1000, alpha=1, b=5, sigma = 0.2, r0=1/500, delta)
nrv <- rnorm(n, out2[n], (sigma*delta)^2)
plot(density(nrv))
lines(density(out2), col = "red")

delta = 0.1
out3 <- Euler(T=500, n=1000, alpha=1, b=5, sigma = 0.2, r0=1/500, delta)
nrv <- rnorm(n, out3[n], (sigma*delta)^2)
plot(density(nrv))
lines(density(out3), col = "red")

delta = 0.01
out4 <- Euler(T=500, n=1000, alpha=1, b=5, sigma = 0.2, r0=1/500, delta)
nrv <- rnorm(n, out4[n], (sigma*delta)^2)
plot(density(nrv))
lines(density(out4), col = "red")

````

(5.3.4)
1.
$$N(5) \sim Poisson(\Lambda)$$
$$\Lambda = \int_0^5\lambda(t)dt=\int_0^5\sqrt{t}e^{-t}sin(2\pi t)dt=$$
$$\Lambda =0.044768 => N(5) \sim Poisson(0.044768)$$

2&3.
````{r}
set.seed(123)

pois_proc <- function(intensity,intmax, tmax){
  
  n <- rpois(1, intmax)
  tt <- runif(n, 0, tmax)
  u<- runif(n)
  accept <- u < intensity(tt) / intmax
  sort(tt[accept])
}

intfun <- function(x) sqrt(x) + exp(-x) * sin(2 * pi* x)

ff <- pois_proc(intfun, 2, 1)
hist(unlist(replicate(1000, pois_proc(intfun, 2, 1))), xlab ="", main = "Simulated Data")
curve(intfun(x)*100, 0, 1, add = TRUE, col = "red")
````

